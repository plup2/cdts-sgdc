# Compiling the CDTS Soy Templates

## Compiler Version

As of this writing, the SOY files are compiled using an old version of the compiler and message extractor.  

>The version has been identified as: **2012-12-21**

Using the newer version of these tools was investigated but was ultimately rejected because:
  - The code generated by new compiler no longer consists of a relatively small Javascript file that only needs an equally small `soyutils.js` library to be used. The code generated by the new compiler is dependant on the Google Closure library and must be further compiled against it. This results in a much bigger file size. (for example, `wet-en.js` produced by old compiler is 55KB, with `soyutils.js` 23KB for a total of 78KB. `wet-en.js` produced with new compilers is 335KB!
  - This much bigger file size comes with no real benefit.  In other words the CDTS is not using any SOY feature that could justify the use of the new compiler.
  - Neither the old or new compiler are supported by Google anyway.

If switching to the new compiler is being reconsidered, see `compiler/README-newcompiler.md` and `Gruntfile-newcompiler.js` for information/setup.

## Google SOY Compiler/Library

Two things are needed to compile and use the CDTS template Soy files: the Google SOY compiler and its Javascript libraries `soyutils.js`. When compiling the SOY files, the Google SOY compiler takes `.soy` files as input (along with language/translation files if any) and produces Javascript files.
These Javascript files can be used directly in the browser, along with a provided "soyutils.js" file.

**Both the compiler (must be named `SoyToJsSrcCompiler.jar`) and message extractor (must be named `SoyMsgExtractor.jar`) must be downloaded manually and put in the `compilers` directory.**  The `soyutils.js` is packaged with the compiler. See the links section below.

### Invoking

The SOY compiler is invoked from `Grunfile.js` using the `grunt-run-java` module, by the `compile-soy` and `i18n-soy` tasks.

**Note**: There is a module called `grunt-soy-compile` but it has a bug when dealing with translation and multiple input files, which is why we're using the `grunt-run-java` module instead.

### Links

  - **To download the original/legacy version of the compiler and soyutils.js:** https://code.google.com/archive/p/closure-templates/downloads?page=1
  - **To download latest version of compiler and libraries:** https://repo1.maven.org/maven2/com/google/template/soy/
  - **Github Project:** https://github.com/google/closure-templates
  - **Documentation:** https://github.com/google/closure-templates/tree/master/documentation
  - **Run-java Module:** https://www.npmjs.com/package/grunt-run-java

  
